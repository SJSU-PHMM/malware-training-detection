library("aphid")

zeroaccess1_initial.PHMM <- derivePHMM(zeroaccess.msa)

#Train phmm using sequence.
zeroaccess_trained.PHMM <- train(zeroaccess_initial.PHMM, zeroaccessTrain1, method = "BaumWelch", deltaLL = 0.01, seqweights = NULL)
#virus api seq to be tested

#virus1_api_seq_to_be_tested <- c('A','A','A','P','P','P','A','G')

#zeroaccesstoTest1 <- toChar("E``_2i[hqqqqqqqEEqE[!_`")

# Detect virus based on the sequence below.

probv_zeroaccess <-c ()
malwareLabels <-c ()
for(i in 1:length(zeroaccessTesting)){

  x <- forward(zeroaccess_trained.PHMM, zeroaccessTesting[i], odds = TRUE)
  print(x)
  probv_zeroaccess[i] <- x$score
  malwareLabels[i] <- 1
}

x <- forward(zeroaccess_trained.PHMM, notepad, odds = TRUE)
probv_zeroaccess[i] <- x$score
malwareLabels[i] <- 0

i = i+1
x <- forward(zeroaccess_trained.PHMM, internetexplorer, odds = TRUE)
probv_zeroaccess[i] <- x$score
malwareLabels[i] <- 0

AUC(probv_zeroaccess, malwareLabels, label.ordering = NULL)



x <- forward(zeroaccess_trained.PHMM, zeroaccessTesting[1], odds = TRUE)
v <- Viterbi(zeroaccess_trained.PHMM, zeroaccessTesting[1], qe=NULL)


#Check the probabiliy
x$score


# generating a sample virus seq. Ideally it has to come from actual Virus API sequences.
virus1_seq <- list(length = 10)
suppressWarnings(RNGversion("3.5.0"))
set.seed(9999)
for(i in 1:10) virus1_seq[[i]] <- generate(virus1_initial.PHMM, size=20)
